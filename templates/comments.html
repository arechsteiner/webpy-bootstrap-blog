$def with(count,comments)
<aside class="comments" id="comments">
	<hr>
	<h2><i class="icon-comments"></i> $count Comments</h2>
	$for comment in comments:
    	$ indent = comment.indent
		$ indent_txt = ""
		$while indent != 0:
			$ indent_txt += " reply"
			$ indent = indent - 1
		<article class="comment $:(indent_txt)">
		    <header class="clearfix">
		    	$#calc image md5 for gravatar
		    	$ md5 = hashlib.new("md5")
		    	$ md5.update(comment.email.strip()+"")
		    	$ md5 = md5.hexdigest()
		    	<img src="http://www.gravatar.com/avatar/$(md5)?d=identicon" alt="Comment Author Gravatar" class="avatar">
		        $#<img src="static/img/avatar.png" alt="A Smart Guy" class="avatar">
		        <div class="meta">
		            <h3><a href="#">$(comment.author)</a></h3>
		            <span class="date"> $(comment.created_at)</span>
		            <span class="separator">-</span>
		            <a class = "replyto" commentid="$comment.id" href="#create-comment" class="reply-link">Reply</a>                
		        </div>
		    </header>
		    <div class="body">
		    <div class="comment-title" id="ctitle$(comment.id)">$(comment.title)</div>
		    	$#TODO: Right now this escapes all html, which is good
		    	$# but when users type enter for a newline
		    	$# it gets ignored when rendered, we need to find a way
		    	$# to convert newlines to <br> or something
		        $(comment.text)
		    </div>
		    </article>

</aside>

